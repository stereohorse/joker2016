# dynamically generated nginx config

{{range services -}}
upstream {{.Name}} {
  least_conn;

  keepalive 5;

  {{range service .Name -}}
    server {{.Address}}:{{.Port}} max_fails=3 fail_timeout=60;
  {{else}}
    server localhost:60000;
  {{end}}
}

{{end}}


server {
  {{range services}}
  location /{{.Name}}/ {
    proxy_http_version 1.1;

    proxy_pass http://{{.Name}}/;
  }
  {{end}}
}
